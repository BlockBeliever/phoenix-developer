<h1 id="webview-javascript-bridge-authentication">WebView JavaScript
Bridge Authentication</h1>
<p>A comprehensive guide for implementing WebView JavaScript Bridge
authentication in your PNDAO app.</p>
<h2 id="overview">Overview</h2>
<p>This system enables seamless communication between a native mobile
app and a WebView, specifically for handling user authentication through
a JavaScript bridge interface.</p>
<h2 id="components">Components</h2>
<h3 id="bridge-setup-utility">1. Bridge Setup Utility</h3>
<p>The bridge utility establishes communication between the WebView and
the native app.</p>
<h4 id="file-utilsbridge.ts">File: <code>utils/bridge.ts</code></h4>
<div class="sourceCode" id="cb1"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> setupWebViewJavascriptBridge <span class="op">=</span> (callback<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WebViewJavascriptBridge</span>) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">callback</span>((<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WebViewJavascriptBridge</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WVJBCallbacks</span>) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WVJBCallbacks</span><span class="op">.</span><span class="fu">push</span>(callback)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  (<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WVJBCallbacks</span> <span class="op">=</span> [callback]<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> WVJBIframe <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">&quot;iframe&quot;</span>)<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  WVJBIframe<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">&quot;none&quot;</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  WVJBIframe<span class="op">.</span><span class="at">src</span> <span class="op">=</span> <span class="st">&quot;https://__bridge_loaded__&quot;</span><span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">documentElement</span><span class="op">.</span><span class="fu">appendChild</span>(WVJBIframe)<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setTimeout</span>(<span class="kw">function</span> () {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">documentElement</span><span class="op">.</span><span class="fu">removeChild</span>(WVJBIframe)<span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h3 id="authentication-bridge-handler">2. Authentication Bridge
Handler</h3>
<p>The main authentication handler that processes user data from the
native app.</p>
<h4 id="bridge-method-responseauthentication">Bridge Method:
<code>responseAuthentication</code></h4>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>int64</td>
<td>✅</td>
<td>PNDAO app user ID</td>
</tr>
<tr class="even">
<td>username</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app username</td>
</tr>
<tr class="odd">
<td>nickname</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app nickname</td>
</tr>
<tr class="even">
<td>avatar</td>
<td>string</td>
<td>❌</td>
<td>PNDAO app user avatar</td>
</tr>
</tbody>
</table>
<h4 id="implementation-example">Implementation Example</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setupWebViewJavascriptBridge</span>(<span class="kw">function</span> (bridge<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  bridge<span class="op">.</span><span class="fu">init</span>(<span class="kw">function</span> (message<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> responseCallback<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (responseCallback) {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">responseCallback</span>({ <span class="st">&quot;Javascript Responds&quot;</span><span class="op">:</span> <span class="st">&quot;defaultHandler&quot;</span> })<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  bridge<span class="op">.</span><span class="fu">registerHandler</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;responseAuthentication&quot;</span><span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">async</span> <span class="kw">function</span> (response<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> requestParams <span class="op">=</span> {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        uid<span class="op">:</span> response[<span class="st">&quot;uid&quot;</span>]<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        username<span class="op">:</span> response[<span class="st">&quot;username&quot;</span>]<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        nickname<span class="op">:</span> response[<span class="st">&quot;nickname&quot;</span>]<span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        avatar<span class="op">:</span> response[<span class="st">&quot;avatar&quot;</span>]<span class="op">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        refferalUid<span class="op">:</span> response[<span class="st">&quot;referrer&quot;</span>]<span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Attempt login</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      isLoading<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { code<span class="op">,</span> data<span class="op">,</span> message<span class="op">,</span> error } <span class="op">=</span> <span class="cf">await</span> <span class="fu">appLogin</span>(requestParams)<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      isLoading<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (code <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">loginSuccess</span>(data)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Handle user not found - redirect to registration</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (message <span class="op">==</span> <span class="st">&quot;USER_NOT_FOUND&quot;</span> <span class="op">&amp;&amp;</span> error <span class="op">==</span> <span class="st">&quot;USER_NOT_FOUND&quot;</span>) {</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        router<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>          path<span class="op">:</span> <span class="st">&quot;/pndao-auth&quot;</span><span class="op">,</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>          query<span class="op">:</span> requestParams<span class="op">,</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">handleErrorCheck</span>(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        message<span class="op">,</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">t</span>(<span class="vs">`api.auth.</span><span class="sc">${</span>error<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">te</span>(<span class="vs">`api.auth.</span><span class="sc">${</span>error<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h3 id="login-api-endpoint">3. Login API Endpoint</h3>
<p>The backend API endpoint that processes authentication requests.</p>
<h4 id="endpoint-app-login">Endpoint: <code>/app-login</code></h4>
<p><strong>Method:</strong> <code>POST</code><br />
<strong>Content-Type:</strong> <code>application/json</code></p>
<h4 id="request-body">Request Body</h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>int64</td>
<td>✅</td>
<td>PNDAO app user ID</td>
</tr>
<tr class="even">
<td>username</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app username</td>
</tr>
<tr class="odd">
<td>nickname</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app nickname</td>
</tr>
<tr class="even">
<td>avatar</td>
<td>string</td>
<td>❌</td>
<td>PNDAO app user avatar</td>
</tr>
</tbody>
</table>
<h4 id="response-format">Response Format</h4>
<div class="sourceCode" id="cb3"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Success&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;data&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;access_token&quot;</span><span class="fu">:</span> <span class="st">&quot;bearer_token_string&quot;</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;expires_in&quot;</span><span class="fu">:</span> <span class="dv">3600</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;refresh_token&quot;</span><span class="fu">:</span> <span class="st">&quot;refresh_token_string&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-fields">Response Fields</h4>
<table>
<thead>
<tr class="header">
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>code</td>
<td>int32</td>
<td>Response status code</td>
</tr>
<tr class="even">
<td>message</td>
<td>string</td>
<td>Response message</td>
</tr>
<tr class="odd">
<td>data</td>
<td>object</td>
<td>Authentication data</td>
</tr>
<tr class="even">
<td>└─access_token</td>
<td>string</td>
<td>Bearer token for API requests</td>
</tr>
<tr class="odd">
<td>└─expires_in</td>
<td>int64</td>
<td>Token expiration time</td>
</tr>
<tr class="even">
<td>└─refresh_token</td>
<td>string</td>
<td>Token for refreshing access</td>
</tr>
</tbody>
</table>
<h3 id="register-api-endpoint">4. Register API Endpoint</h3>
<p>The backend API endpoint that processes when user not found.</p>
<h4 id="endpoint-app-register">Endpoint: <code>/app-register</code></h4>
<p><strong>Method:</strong> <code>POST</code><br />
<strong>Content-Type:</strong> <code>application/json</code></p>
<h4 id="request-body-1">Request Body</h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>int64</td>
<td>✅</td>
<td>PNDAO app user ID</td>
</tr>
<tr class="even">
<td>username</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app username</td>
</tr>
<tr class="odd">
<td>nickname</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app nickname</td>
</tr>
<tr class="even">
<td>avatar</td>
<td>string</td>
<td>❌</td>
<td>PNDAO app user avatar</td>
</tr>
<tr class="odd">
<td>account</td>
<td>string</td>
<td>✅</td>
<td>dapp account</td>
</tr>
<tr class="even">
<td>password</td>
<td>string</td>
<td>✅</td>
<td>dapp password</td>
</tr>
<tr class="odd">
<td>refferalCode</td>
<td>string</td>
<td>✅</td>
<td>dapp invite code</td>
</tr>
</tbody>
</table>
<h4 id="response-format-1">Response Format</h4>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Success&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;data&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;access_token&quot;</span><span class="fu">:</span> <span class="st">&quot;bearer_token_string&quot;</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;expires_in&quot;</span><span class="fu">:</span> <span class="dv">3600</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;refresh_token&quot;</span><span class="fu">:</span> <span class="st">&quot;refresh_token_string&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-fields-1">Response Fields</h4>
<table>
<thead>
<tr class="header">
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>code</td>
<td>int32</td>
<td>Response status code</td>
</tr>
<tr class="even">
<td>message</td>
<td>string</td>
<td>Response message</td>
</tr>
<tr class="odd">
<td>data</td>
<td>object</td>
<td>Authentication data</td>
</tr>
<tr class="even">
<td>└─access_token</td>
<td>string</td>
<td>Bearer token for API requests</td>
</tr>
<tr class="odd">
<td>└─expires_in</td>
<td>int64</td>
<td>Token expiration time</td>
</tr>
<tr class="even">
<td>└─refresh_token</td>
<td>string</td>
<td>Token for refreshing access</td>
</tr>
</tbody>
</table>
<h3 id="binding-api-endpoint">5. Binding API Endpoint</h3>
<p>The backend API endpoint that processes when dapp account exist.</p>
<h4 id="endpoint-app-binding">Endpoint: <code>/app-binding</code></h4>
<p><strong>Method:</strong> <code>POST</code><br />
<strong>Content-Type:</strong> <code>application/json</code></p>
<h4 id="request-body-2">Request Body</h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>int64</td>
<td>✅</td>
<td>PNDAO app user ID</td>
</tr>
<tr class="even">
<td>username</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app username</td>
</tr>
<tr class="odd">
<td>nickname</td>
<td>string</td>
<td>✅</td>
<td>PNDAO app nickname</td>
</tr>
<tr class="even">
<td>avatar</td>
<td>string</td>
<td>❌</td>
<td>PNDAO app user avatar</td>
</tr>
<tr class="odd">
<td>account</td>
<td>string</td>
<td>✅</td>
<td>dapp account</td>
</tr>
<tr class="even">
<td>password</td>
<td>string</td>
<td>✅</td>
<td>dapp password</td>
</tr>
</tbody>
</table>
<h4 id="response-format-2">Response Format</h4>
<div class="sourceCode" id="cb5"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Success&quot;</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;data&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;access_token&quot;</span><span class="fu">:</span> <span class="st">&quot;bearer_token_string&quot;</span><span class="fu">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;expires_in&quot;</span><span class="fu">:</span> <span class="dv">3600</span><span class="fu">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;refresh_token&quot;</span><span class="fu">:</span> <span class="st">&quot;refresh_token_string&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="response-fields-2">Response Fields</h4>
<table>
<thead>
<tr class="header">
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>code</td>
<td>int32</td>
<td>Response status code</td>
</tr>
<tr class="even">
<td>message</td>
<td>string</td>
<td>Response message</td>
</tr>
<tr class="odd">
<td>data</td>
<td>object</td>
<td>Authentication data</td>
</tr>
<tr class="even">
<td>└─access_token</td>
<td>string</td>
<td>Bearer token for API requests</td>
</tr>
<tr class="odd">
<td>└─expires_in</td>
<td>int64</td>
<td>Token expiration time</td>
</tr>
<tr class="even">
<td>└─refresh_token</td>
<td>string</td>
<td>Token for refreshing access</td>
</tr>
</tbody>
</table>
<h3 id="pndao-customer-service-bridge">6. PNDAO Customer Service
Bridge</h3>
<p>Customer service bridge for PNDAO app communication.</p>
<h4 id="bridge-method-contactcustomservice">Bridge Method:
<code>contactCustomService</code></h4>
<p>This bridge method allows the WebView to initiate customer service
contact through the native app.</p>
<h4 id="parameters">Parameters</h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uid</td>
<td>int64</td>
<td>✅</td>
<td>dapp user ID</td>
</tr>
<tr class="even">
<td>contact_id</td>
<td>int64</td>
<td>✅</td>
<td>PNDAO Service account ID</td>
</tr>
</tbody>
</table>
<h4 id="implementation-example-1">Implementation Example</h4>
<div class="sourceCode" id="cb6"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Contact customer service through bridge</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> contactService <span class="op">=</span> (serviceAccount<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> params <span class="op">=</span> {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    uid<span class="op">:</span> <span class="bu">Number</span>(userStore<span class="op">.</span><span class="at">uid</span>)<span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    contact_id<span class="op">:</span> <span class="bu">Number</span>(serviceAccount<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  (<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WebViewJavascriptBridge</span><span class="op">.</span><span class="fu">callHandler</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;contactCustomService&quot;</span><span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(params)<span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> (responseData<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Handle response from native app</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Customer service response:&quot;</span><span class="op">,</span> responseData)<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h2 id="pndao-dapp-pay-bridge">7. PNDAO Dapp Pay Bridge</h2>
<p>Pay function in PNDAO app.</p>
<h3 id="bridge-method-paydapp">Bridge Method: <code>payDapp</code></h3>
<h4 id="parameters-1">Parameters</h4>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 29%" />
<col style="width: 9%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>order_id</td>
<td>string</td>
<td>✅</td>
<td>Pay order id</td>
</tr>
<tr class="even">
<td>seller_wallet_address</td>
<td>string</td>
<td>✅</td>
<td>From address in wallet</td>
</tr>
<tr class="odd">
<td>buyer_wallet_address</td>
<td>string</td>
<td>✅</td>
<td>To address in wallet</td>
</tr>
<tr class="even">
<td>symbol</td>
<td>string</td>
<td>✅</td>
<td>Token symbol (only USDK)</td>
</tr>
<tr class="odd">
<td>amount</td>
<td>string || number</td>
<td>✅</td>
<td>Transfer amount</td>
</tr>
<tr class="even">
<td>price</td>
<td>string</td>
<td>✅</td>
<td>Token quantity (amount * 100000)</td>
</tr>
</tbody>
</table>
<h4 id="implementation-example-2">Implementation Example</h4>
<div class="sourceCode" id="cb7"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">window</span> <span class="im">as</span> <span class="dt">any</span>)<span class="op">.</span><span class="at">WebViewJavascriptBridge</span><span class="op">.</span><span class="fu">callHandler</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;payDapp&quot;</span><span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    order_id<span class="op">:</span> snowflake<span class="op">.</span><span class="fu">generate</span>()<span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    seller_wallet_address<span class="op">:</span> fromAddress<span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    buyer_wallet_address<span class="op">:</span> toAddress<span class="op">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    symbol<span class="op">:</span> <span class="st">&quot;USDK&quot;</span><span class="op">,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">:</span> amount<span class="op">,</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    price<span class="op">:</span> amount <span class="op">*</span> <span class="dv">100000</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> (responseData<span class="op">:</span> <span class="dt">any</span>) {}</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div>
<h2 id="pndao-dapp-pay-response-bridge">8. PNDAO Dapp Pay Response
Bridge</h2>
<p>Pay response function in PNDAO app.</p>
<h3 id="bridge-method-responsepaydapp">Bridge Method:
<code>responsePayDapp</code></h3>
<h4 id="response-parameters">Response Parameters</h4>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>orderId</td>
<td>string</td>
<td>Pay order id</td>
</tr>
<tr class="even">
<td>txHash</td>
<td>string</td>
<td>Transaction hash</td>
</tr>
<tr class="odd">
<td>fromAddress</td>
<td>string</td>
<td>From address in wallet</td>
</tr>
<tr class="even">
<td>toAddress</td>
<td>string</td>
<td>To address in wallet</td>
</tr>
<tr class="odd">
<td>amount</td>
<td>string || number</td>
<td>Transfer amount</td>
</tr>
</tbody>
</table>
<h4 id="implementation-example-3">Implementation Example</h4>
<div class="sourceCode" id="cb8"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setupWebViewJavascriptBridge</span>(<span class="kw">function</span> (bridge<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  bridge<span class="op">.</span><span class="fu">init</span>(<span class="kw">function</span> (message<span class="op">:</span> <span class="dt">any</span><span class="op">,</span> responseCallback<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (responseCallback) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">responseCallback</span>({ <span class="st">&quot;Javascript Responds&quot;</span><span class="op">:</span> <span class="st">&quot;defaultHandler&quot;</span> })<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// register handler</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  bridge<span class="op">.</span><span class="fu">registerHandler</span>(<span class="st">&quot;responsePayDapp&quot;</span><span class="op">,</span> <span class="kw">async</span> <span class="kw">function</span> (response<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;responsePayDapp completed:&quot;</span><span class="op">,</span> response)<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { code<span class="op">,</span> error<span class="op">,</span> data<span class="op">,</span> message } <span class="op">=</span> <span class="cf">await</span> <span class="fu">rechargeAdd</span>({</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      chain<span class="op">:</span> protocol<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">type</span><span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      address<span class="op">:</span> protocol<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">account</span><span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      amount<span class="op">:</span> <span class="fu">multiply</span>(money<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      currency<span class="op">:</span> <span class="st">&quot;USDT&quot;</span><span class="op">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      originalAmount<span class="op">:</span> <span class="fu">multiply</span>(money<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      isCertified<span class="op">:</span> protocol<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">isCertified</span><span class="op">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      payType<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      orderId<span class="op">:</span> response[<span class="st">&quot;orderId&quot;</span>]<span class="op">,</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      txHash<span class="op">:</span> response[<span class="st">&quot;txHash&quot;</span>]<span class="op">,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      fromAddress<span class="op">:</span> response[<span class="st">&quot;fromAddress&quot;</span>]<span class="op">,</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      toAddress<span class="op">:</span> response[<span class="st">&quot;toAddress&quot;</span>]<span class="op">,</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      txAmount<span class="op">:</span> response[<span class="st">&quot;amount&quot;</span>]<span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>code) {</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>      router<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        path<span class="op">:</span> <span class="st">&quot;/center/rechargeNow&quot;</span><span class="op">,</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        query<span class="op">:</span> {</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>          id<span class="op">:</span> data<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>          chainAddress<span class="op">:</span> protocol<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">account</span><span class="op">,</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>          chain<span class="op">:</span> protocol<span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">type</span><span class="op">,</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>          amount<span class="op">:</span> money<span class="op">.</span><span class="at">value</span><span class="op">,</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">handleErrorCheck</span>(</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      message<span class="op">,</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(<span class="vs">`front.api.center.</span><span class="sc">${</span>error<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">te</span>(<span class="vs">`front.api.center.</span><span class="sc">${</span>error<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<h2 id="authentication-flow">Authentication Flow</h2>
<pre class="mermaid"><code>sequenceDiagram
    participant App as Native App
    participant WebView as WebView
    participant API as Backend API

    App-&gt;&gt;WebView: Initialize bridge
    WebView-&gt;&gt;WebView: Setup bridge handlers
    App-&gt;&gt;WebView: Send user data via responseAuthentication
    WebView-&gt;&gt;API: POST /app-login with user data

    alt User exists
        API-&gt;&gt;WebView: Return tokens
        WebView-&gt;&gt;WebView: loginSuccess(data)
    else User not found
        API-&gt;&gt;WebView: USER_NOT_FOUND error
        WebView-&gt;&gt;WebView: Redirect to /pndao-auth
    else Other error
        API-&gt;&gt;WebView: Error response
        WebView-&gt;&gt;WebView: handleErrorCheck()
    end</code></pre>
<h2 id="implementation-steps">Implementation Steps</h2>
<h3 id="setup-bridge-communication">1. Setup Bridge Communication</h3>
<ol type="1">
<li>Import the bridge utility in your WebView component</li>
<li>Initialize the bridge with appropriate handlers</li>
<li>Register the <code>responseAuthentication</code> handler</li>
</ol>
<h3 id="handle-authentication-response">2. Handle Authentication
Response</h3>
<ol type="1">
<li>Extract user data from the bridge response</li>
<li>Call the <code>/app-login</code> API endpoint</li>
<li>Handle success, user not found, and error cases appropriately</li>
</ol>
<h3 id="error-handling">3. Error Handling</h3>
<p>The system handles three main scenarios:</p>
<ul>
<li><strong>Success (code: 0)</strong>: User authenticated
successfully</li>
<li><strong>User Not Found</strong>: Redirect to registration/binding
page</li>
<li><strong>Other Errors</strong>: Display appropriate error
messages</li>
</ul>
<h2 id="error-codes">Error Codes</h2>
<table>
<thead>
<tr class="header">
<th>Code</th>
<th>Message</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Success</td>
<td>Authentication successful</td>
</tr>
<tr class="even">
<td>-1</td>
<td>USER_NOT_FOUND</td>
<td>User needs to register or bind account</td>
</tr>
<tr class="odd">
<td>Others</td>
<td>Various</td>
<td>Check API documentation for details</td>
</tr>
</tbody>
</table>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li>TypeScript support</li>
<li>Vue Router (for navigation)</li>
<li>Internationalization library (for error messages)</li>
<li>HTTP client for API calls</li>
</ul>
<h2 id="usage-notes">Usage Notes</h2>
<ol type="1">
<li>Ensure the WebView has JavaScript enabled</li>
<li>The bridge URL <code>https://__bridge_loaded__</code> is a special
protocol for bridge initialization</li>
<li>Handle loading states appropriately during authentication</li>
<li>Implement proper error handling for network failures</li>
<li>Consider implementing token refresh mechanisms</li>
</ol>
<h2 id="security-considerations">Security Considerations</h2>
<ul>
<li>Validate all incoming bridge data</li>
<li>Implement proper token storage (secure storage recommended)</li>
<li>Handle token expiration gracefully</li>
<li>Use HTTPS for all API communications</li>
<li>Implement proper logout functionality to clear stored tokens</li>
</ul>
